<!DOCTYPE html>
<html lang="ja">
  <head>
      <meta charset="UTF-8">
      <link href="index.css" rel="stylesheet" type="text/css" media="all">
      <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
      <script src="index.js"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Detail | Ayaka Yabuki</title>
  </head>
  <body>
    <div id="header_fetch_target"></div>

    <div class="contents_fadein">
        <div class="bodybox">
            <h1>Archives</h1>

            <div class="center_contents media_container">
                <div class="swiper">
                    <div class="swiper-wrapper" id="media_slides">
                        </div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-button-next"></div>
                </div>
                <div class="swiper-pagination"></div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

            <div class="profile_sentence template_box">
                <ul style="display:flex; gap:10px; align-items:center; list-style:none; padding:0;">
                    <p id="detail_date" class="date"></p>
                    <p id="detail_category"></p>
                </ul>
                <h2 id="detail_title" class="lang_ja"></h2>
                <h2 id="detail_title_en" class="lang_en"></h2>

                <p id="detail_content" class="lang_ja" style="margin-top:30px;"></p>
                <p id="detail_content_en" class="lang_en" style="margin-top:30px;"></p>
                
                <p style="margin-top:50px;"><a href="archives.html"><< Back to Archives</a></p>
            </div>
        </div>
    </div>

    <div id="footer_fetch_target"></div>

    <script async src="//www.instagram.com/embed.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const archivesId = urlParams.get('id');

        fetch('archives_data.json')
            .then(response => response.json())
            .then(data => {
                const item = data.find(p => p.id === archivesId);
                if (!item) return;

                // 基本情報の表示
                document.getElementById('detail_date').innerText = item.date;
                document.getElementById('detail_title').innerText = item.title_ja;
                document.getElementById('detail_title_en').innerText = item.title_en;
                document.getElementById('detail_content').innerHTML = item.content_ja;
                document.getElementById('detail_content_en').innerHTML = item.content_en;
                

                const slidesContainer = document.getElementById('media_slides');
                // メディア候補を配列にまとめる
                const mediaSources = [
                    { type: 'url', val: item.url },
                    { type: 'url', val: item.url2 },
                    { type: 'img', val: item.image }
                ].filter(m => m.val); // データが存在するものだけ抽出

                mediaSources.forEach(media => {
                    let content = "";
                    if (media.type === 'url') {
                        if (media.val.includes('youtube.com') || media.val.includes('youtu.be')) {
                            const videoId = media.val.split('v=')[1] || media.val.split('/').pop().split('?')[0];
                            content = `<div class="video_wrapper"><iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe></div>`;
                        } else if (media.val.includes('instagram.com')) {
                            const instaUrl = media.val.endsWith('/') ? media.val : media.val + '/';
                            content = `<div class="insta_container"><blockquote class="instagram-media" data-instgrm-permalink="${instaUrl}embed/" data-instgrm-version="14"></blockquote></div>`;
                        }
                    } else {
                        content = `<img src="${media.val}" alt="">`;
                    }
                    
                    // スライドとして追加
                    slidesContainer.insertAdjacentHTML('beforeend', `<div class="swiper-slide">${content}</div>`);
                });

                // スライド生成後に Swiper を初期化
                const swiper = new Swiper('.swiper', {
                    loop: mediaSources.length > 1, // 1枚以上の時だけループ
                    pagination: { el: '.swiper-pagination', clickable: true },
                    navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
                    autoHeight: false, // コンテンツ（画像や動画）の高さに合わせる
                });

                // Instagram の再スキャン
                if (window.instgrm) {
                    window.instgrm.Embeds.process(); 
                }

                // カテゴリ付与
                const catEl = document.getElementById('detail_category');
                catEl.className = item.category === 'category_mv' ? 'mv' : 'play';

                applyLanguage(lang, false);
            });
    </script>
  </body>
</html>